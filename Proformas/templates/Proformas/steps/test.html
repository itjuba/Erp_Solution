
{% extends 'base.html'%}
<!--{% load widget_tweaks %}-->
{% load crispy_forms_tags %}
{% load static%}

{% block javascript %}
  <script src="{% static 'js/tva.js' %}"></script>


<script language="JavaScript">
  $(document).ready(function() {
     $("#submit").click(function(e) {

         var total = 0;
         $('.mt').each(function (ind) {

             prix = parseFloat($(this).val())
             console.log(prix)
             total = parseFloat(total + prix)
             console.log(total)
         });
         var sah = $('#id_Montant_HT').val()
       //  console.log(sah)
       //  console.log(total)
         if(!total){
              var message = 'verifier le champs Montant_HT *Commande_Designation*'
             md.showNotificationDelete('top', 'center', 'danger', message);
         }
         else {
             if (total & total != sah) {
                 var message = 'Le Total des commande ne correspond pas à le montant HT   :  total =' + ' ' + total + ' ' + 'Montant HT = ' + sah
                 md.showNotificationDelete('top', 'center', 'danger', message);
                 //    console.log('here')
             } else {
                 //     console.log('after here')
                 var csrftoken = $('[name="csrfmiddlewaretoken"]').val();
                 //e.preventDefault();
                 $.ajax({
                     headers: {

                         "X-CSRFToken": csrftoken
                     },
                     data: $('#form-one').serialize(),
                     type: 'POST',
                     url: '/commande/test',

                     success: function (response) {
                         if (response.errors) {
                             //  console.log(response.errors['1'])
                             //  md.showNotificationFail('bottom', 'left', 'warning', response.errors);
                             console.log(response.errors)
                             var errors = jQuery.parseJSON(response.errors)

                             console.log(errors)
                             console.log(errors[0])
                             if (errors['Montant_HT']) {
                                 console.log('dkhal')
                                 er = errors['Montant_HT']
                                 msg = 'Commande Montant HT  :' + er
                                 md.showNotificationFail('bottom', 'left', 'warning', msg);
                             }
                             if (errors['Montant_TTC']) {
                                 console.log('dkhal')
                                 er = errors['Montant_TTC']
                                 msg = 'Commande  Montant TTC : ' + er
                                 md.showNotificationFail('bottom', 'left', 'warning', msg);
                             }
                             if (errors['Montant_TVA']) {
                                 console.log('dkhal')
                                 er = errors['Montant_TVA']
                                 msg = 'Commande  Montant TVA : ' + er
                                 md.showNotificationFail('bottom', 'left', 'warning', msg);
                             }
                             if (errors['Date']) {
                                 console.log('dkhal')
                                 er = errors['Date']
                                 msg = 'Commande Date  ' + er
                                 md.showNotificationFail('bottom', 'right', 'warning', msg);
                             }
                             if (errors['Numero_commande']) {
                                 console.log('dkhal')
                                 er = errors['Numero_commande']
                                 msg = 'Commande Numero_commande  :' + er
                                 md.showNotificationFail('bottom', 'right', 'warning', msg);
                             }
                             if (errors['Type_Service']) {
                                 console.log('dkhal')
                                 er = errors['Type_Service']
                                 msg = 'Commande Type_Service  : ' + er
                                 md.showNotificationFail('bottom', 'right', 'warning', msg);
                             }
                             if (errors['Client']) {
                                 console.log('dkhal')
                                 er = errors['Client']
                                 msg = 'Commande Client : ' + er
                                 md.showNotificationFail('bottom', 'right', 'warning', msg);
                             }


                         } else {
                             $.ajax({
                                 headers: {

                                     "X-CSRFToken": csrftoken
                                 },
                                 data: $('#form-two').serialize(),
                                 type: 'POST',
                                 url: '/commande/test2',
                                 success: function (response) {
                                     console.log("success !")
                                     if (response.errors) {
                                         var errors = jQuery.parseJSON(response.errors)

                                         console.log(errors)
                                         console.log(errors[0])
                                         if (errors[0]['Montant_HT']) {
                                             console.log('dkhal')
                                             er = errors[0]['Montant_HT']
                                             msg = 'Commande Designation Montant HT : ' + er
                                             md.showNotificationFail('bottom', 'left', 'warning', msg);
                                         }
                                         if (errors[0]['Montant_TTC']) {
                                             console.log('dkhal')
                                             er = errors[0]['Montant_TTC']
                                             msg = 'Commande Designation Montant TTC : ' + er
                                             md.showNotificationFail('bottom', 'left', 'warning', msg);
                                         }
                                         if (errors[0]['Montant_TVA']) {
                                             console.log('dkhal')
                                             er = errors[0]['Montant_TVA']
                                             msg = 'Commande Designation Montant TVA :' + er
                                             md.showNotificationFail('bottom', 'left', 'warning', msg);
                                         }
                                         if (errors[0]['Quantite']) {
                                             console.log('dkhal')
                                             er = errors[0]['Quantite']
                                             msg = 'Commande Designation Quantite : ' + er
                                             md.showNotificationFail('bottom', 'left', 'warning', msg);
                                         }
                                         if (errors[0]['Prix_Unitaire']) {
                                             console.log('dkhal')
                                             er = errors[0]['Prix_Unitaire']
                                             msg = 'Commande Designation Prix_Unitaire : ' + er
                                             md.showNotificationFail('bottom', 'left', 'warning', msg);
                                         }


                                     } else {
                                         $.ajax({
                                             headers: {

                                                 "X-CSRFToken": csrftoken
                                             },
                                             data: $('#form-three').serialize(),
                                             type: 'POST',
                                             url: '/commande/step3',
                                             success: function (response) {
                                                 console.log("success !")
                                                 if (response.errors) {

                                                     if (response.errors) {
                                                         msg = 'Modalité ' + response.errors
                                                         md.showNotificationFail('bottom', 'left', 'warning', msg);

                                                     }


                                                 } else {

                                                     window.location = '/commande/'
                                                 }

                                             },


                                         });
                                     }
                                 }
                             });


                             //return false;


                         }


                     }
                 });

             }
         }
     });
  });
</script>
{% endblock %}
{% block content %}
<br><br><br><br>
<div>





<div class="content" style="">
            <div class="container-fluid">

<div class="row">
<div class="col-md-12" >
<div class="card">
<div class="card-header card-header-primary">
<h4 class="card-title" style="text-align: center;">Ajouter Commande Designation</h4>
</div>
<div class="card-body">
<div class="table-responsive" >
<form method="POST" id="form-two" action="{% url 'test2' %}">

<table class="table" id="book-table">


<thead class=" text-primary"  >
<th>
Designation
</th>
<th>
Prix_Unitaire
</th>
<!--                        <th>-->
<!--                          Commande-->
<!--                        </th>-->
<th>
Quantite
</th>
<th>
Montant_HT
</th>
<th>
TVA%
</th>
<th>
Montant_TVA
</th>
<th>
Montant_TTC
</th>



</thead>

</thead>
<tbody >
{% include 'Proformas/steps/partial_step.html' %}
</tbody>
</table>
<a  class="btn btn-primary" id="add_test" >Add new row</a>
                    <a  class="btn btn-primary" id="DeleteButton" >delete</a>

</div>
</div>
</div>
</div>
</div>
</div>
</div>



    <div class="content" style="">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header card-header-primary">
                  <h4 class="card-title " style="text-align: center;">Ajouter Commande</h4>
                </div>
                <div class="card-body">
                  <div class="table-responsive" style="overflow: hidden;">
                    <table class="table">


<form method="POST" id="form-one" >
    {% csrf_token %}

<tbody>
   <br><br>
 <div class="form-row" style="margin-left: 25px">

              <div class="form-group col-sm-2 mb-0" id="label1" >
        <label  class="bmd-label-floating"  for="form.id_for_label">Montant_HT &nbsp;</label>
            {% render_field form.Montant_HT class="form-control mont" %}
      </div>
         <div class="form-group col-sm-2 mb-0" id="label2">
          <label class="bmd-label-floating" for="form.id_for_label">Montant_TVA</label>
           {% render_field form.Montant_TVA class="form-control " %}
   </div>


                              <div class="form-group col-sm-2 mb-0" id="label3">
        <label  class="bmd-label-floating" for="form.id_for_label">Montant_TTC &nbsp;</label>
            {% render_field form.Montant_TTC class="form-control " %}
      </div>

  <div class="form-group col-sm-2 mb-0">
          <label class="" for="form.id_for_label">Date</label>
           {% render_field form.Date class="form-control" %}
      </div>



                    <div class="form-group col-sm-2 mb-0">
          <label class="bmd-label-floating" for="form.id_for_label">Numero_commande</label>
           {% render_field form.Numero_commande class="form-control " %}
      </div>

 </div>
     <div class="form-row" style="margin-left: 25px">
     <div class="form-group col-sm-2 mb-0" style="">
          <label class="bmd-label-floating" for="form.id_for_label">Type_Service</label>
           {% render_field form.Type_Service class="form-control" %}
      </div>


                        <div class="form-group col-sm-2 mb-0">
        <label  class="bmd-label-floating" for="form.id_for_label">Client &nbsp;</label>
            {% render_field form.Client class="form-control" %}
      </div>
     </div>

 </tbody>
    </form>
                    </table>
</div>
</div>
 </div>


                  </div>
                </div>
              </div>
            </div>








 <div class="row">
             <div class="container-fluid">

            <div class="col-md-12">
              <div class="card">
                <div class="card-header card-header-primary">
                  <h4 class="card-title " style="text-align: center;">Ajouter Modalité</h4>
                </div>

                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table">


<form id="form-three" method="POST">
    {% csrf_token %}
   <br><br>

  <div style="" >
           <div class="form-row" style="margin-left: 25px">
      <div class="form-group col-md-3 mb-0">
          <label class="bmd-label-floating" for="form.id_for_label">Garantie</label>
           {% render_field modal.Garantie class="form-control" %}
      </div>


      <div class="form-group col-md-3 mb-0">
          <label class="bmd-label-floating" for="form.id_for_label">modalite_payement</label>
           {% render_field modal.modalite_payement class="form-control" %}
      </div>
          <div class="form-group col-md-3 mb-0">
        <label  class="bmd-label-floating" for="form.id_for_label">Arret_Facture &nbsp;</label>
            {% render_field modal.Arret_Facture class="form-control" %}
      </div>



      <div class="form-group col-md-3 mb-0">
          <label class="bmd-label-floating" for="form.id_for_label">Formation</label>
           {% render_field modal.Formation class="form-control " %}
      </div>
          <div class="form-group col-md-3 mb-0">
        <label  class="bmd-label-floating" for="form.id_for_label">Period_Réalisation &nbsp;</label>
            {% render_field modal.Period_Réalisation class="form-control" %}
      </div>


            <div class="form-group col-md-3 mb-0">
        <label  class="bmd-label-floating" for="form.id_for_label">Echéancier_payement &nbsp;</label>
            {% render_field modal.Echéancier_payement class="form-control" %}
      </div>

        <div class="form-group col-md-3 mb-0">
        <label  class="" for="form.id_for_label">Debut_realsiation &nbsp;</label>
            {% render_field modal.Debut_realsiation class="form-control" %}
      </div>


<!--        <div class="form-group col-md-3 mb-0">-->
<!--        <label  class="bmd-label-floating" for="form.id_for_label">Commande &nbsp;</label>-->
<!--            {% render_field modal.Command class="form-control" %}-->
<!--      </div>-->


  </div>
</form>

<!--    <input  id="step1" class="btn btn-primary" type="submit" value="Submit" />-->
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
</div>
    <input  id="submit" class="btn btn-primary" type="submit" value="Submit" />
{% endblock%}